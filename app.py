import streamlit as st
import random
from datetime import datetime, date

# ==========================================
# 1. ç³»çµ±è¨­å®š
# ==========================================
st.set_page_config(
    page_title="2026 å…¨åœ‹è³æ«»ç™¾ç§‘ (è˜‡ä½ç’½åš´é¸)",
    page_icon="ğŸŒ¸",
    layout="wide", # æ”¹ç‚ºå¯¬ç‰ˆä»¥å®¹ç´æ›´å¤šè³‡è¨Š
    initial_sidebar_state="collapsed"
)

# ==========================================
# 2. CSS ç¾å­¸ (ç²‰è‰²ç³» + æ·±è‰²æ¨¡å¼ä¿®å¾© + æ¨™ç±¤å„ªåŒ–)
# ==========================================
st.markdown("""
    <style>
    /* å…¨ç«™åŸºç¤è¨­å®š */
    .stApp {
        background-color: #FFF0F5;
        font-family: "Microsoft JhengHei", sans-serif;
        color: #333333 !important;
    }
    p, div, span, h1, h2, h3, h4, h5, h6, label, .stMarkdown, .stText {
        color: #333333 !important;
    }

    /* è¼¸å…¥å…ƒä»¶ä¿®å¾© */
    div[data-baseweb="select"] > div, 
    div[data-baseweb="input"] > div, 
    div[data-baseweb="base-input"] {
        background-color: #ffffff !important;
        border: 1px solid #cccccc !important;
        color: #333333 !important;
    }
    input { color: #333333 !important; }
    
    /* éš±è—å®˜æ–¹å…ƒä»¶ */
    header {visibility: hidden;}
    footer {display: none !important;}
    
    /* æ¨™é¡Œå€ */
    .header-box {
        background: linear-gradient(135deg, #FF1493 0%, #FF69B4 100%);
        padding: 40px 20px;
        border-radius: 0 0 30px 30px;
        color: white !important;
        text-align: center;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(255, 20, 147, 0.4);
        margin-top: -60px;
    }
    .header-title { font-size: 36px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); color: white !important; }
    
    /* æ™¯é»å¡ç‰‡å„ªåŒ– */
    .spot-card {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 6px solid #FF69B4;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: transform 0.2s;
    }
    .spot-card:hover { transform: translateY(-3px); }
    
    /* æ¨™ç±¤å¾½ç«  */
    .badge {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        color: white !important;
        margin-right: 5px;
        display: inline-block;
    }
    .b-region { background: #6A5ACD; }
    .b-flower { background: #FF69B4; }
    .b-tag { background: #20B2AA; }
    .b-secret { background: #FF4500; box-shadow: 0 0 5px #FF4500; }
    
    /* æœå°‹æ¬„ç‰¹æ•ˆ */
    .search-box {
        border: 2px solid #FF1493;
        border-radius: 50px;
        padding: 10px;
        text-align: center;
        background: white;
        margin-bottom: 20px;
    }
    </style>
""", unsafe_allow_html=True)

# ==========================================
# 3. æ ¸å¿ƒè³‡æ–™åº« (çµ‚æ¥µæ“´å……ç‰ˆ - 50+ æ™¯é»)
# ==========================================
# å¢åŠ æ¬„ä½: "tags" (é©åˆæœå°‹)
all_spots_db = [
    # === ğŸ‘‘ æ¡ƒåœ’å¾©èˆˆå€ (è˜‡å€é•·æœ¬å‘½å€) ===
    {"name": "æ‹‰æ‹‰å±±æ©æ„›è¾²å ´", "region": "åŒ—éƒ¨", "loc": "æ¡ƒåœ’å¾©èˆˆ", "month": [2, 3], "flower": "åƒå³¶æ«»/å¯Œå£«æ«»", "fee": "$100", "tags": ["å¤§æ™¯", "é›²æµ·", "æ”å½±"], "desc": "ç²‰ç´…æ«»èŠ±èˆ‡é›²æµ·åŒæ¡†çš„å¤¢å¹»å¤§æ™¯ã€‚"},
    {"name": "ä¸­å·´é™µæ«»æœ¨èŠ±é“", "region": "åŒ—éƒ¨", "loc": "æ¡ƒåœ’å¾©èˆˆ", "month": [2], "flower": "æ˜­å’Œæ«»", "fee": "å…è²»", "tags": ["ç§˜å¢ƒ", "éš§é“", "å…è²»"], "desc": "åŒ—æ©«å…¬è·¯æ—æœ€ç¾çš„ç²‰ç´…éš§é“ã€‚"},
    {"name": "è§’æ¿å±±è¡Œé¤¨", "region": "åŒ—éƒ¨", "loc": "æ¡ƒåœ’å¾©èˆˆ", "month": [1, 2], "flower": "æ¢…èŠ±/å±±æ«»", "fee": "å…è²»", "tags": ["è¦ªå­", "æ­·å²", "å¹³åœ°"], "desc": "è³èŠ±é‚„èƒ½é€›æˆ°å‚™éš§é“ï¼Œé©åˆå…¨å®¶å‡ºéŠã€‚"},
    {"name": "æ±çœ¼å±±æ£®æ—éŠæ¨‚å€", "region": "åŒ—éƒ¨", "loc": "æ¡ƒåœ’å¾©èˆˆ", "month": [2, 3], "flower": "å±±æ«»èŠ±", "fee": "$80", "tags": ["å¥è¡Œ", "æ£®æ—", "é¿æš‘"], "desc": "æ¼«æ­¥åœ¨æŸ³æ‰æ—ä¸­çš„ç²‰ç´…é©šå–œã€‚"},
    {"name": "å£½å±±å·–è§€éŸ³å¯º", "region": "åŒ—éƒ¨", "loc": "æ¡ƒåœ’é¾œå±±", "month": [2], "flower": "å¯’æ«»", "fee": "å…è²»", "tags": ["å»Ÿå®‡", "å¹³åœ°", "æ˜“é”"], "desc": "æ¡ƒåœ’å¸‚å€æœ€è¿‘çš„è³æ«»åæ‰€ï¼Œé¦™ç«é¼ç››ã€‚"},

    # === ğŸ™ï¸ å°åŒ—/æ–°åŒ— (éƒ½æœƒèˆ‡è¿‘éƒŠ) ===
    {"name": "æ·¡æ°´å¤©å…ƒå®®", "region": "åŒ—éƒ¨", "loc": "æ–°åŒ—æ·¡æ°´", "month": [2, 3], "flower": "ä¸‰è‰²æ«»/å‰é‡æ«»", "fee": "å…è²»", "tags": ["åœ°æ¨™", "å¤œæ«»", "ç¶²ç¾"], "desc": "ç„¡æ¥µçœŸå…ƒå¤©å£‡èˆ‡æ«»èŠ±äº¤ç¹”ï¼Œå…¨å°æœ€ç¶“å…¸ã€‚"},
    {"name": "å…§æ¹–æ¨‚æ´»å…¬åœ’", "region": "åŒ—éƒ¨", "loc": "å°åŒ—å…§æ¹–", "month": [2], "flower": "å¯’æ«»/å…«é‡æ«»", "fee": "å…è²»", "tags": ["å¤œæ«»", "æ·é‹", "è¦ªå­"], "desc": "æ­æ·é‹å°±èƒ½åˆ°ï¼æ²¿è‘—æºªç•”çš„å¤¢å¹»å¤œæ«»ã€‚"},
    {"name": "é™½æ˜å±±å¹³èè¡—42å··", "region": "åŒ—éƒ¨", "loc": "å°åŒ—å£«æ—", "month": [1, 2], "flower": "å¯’æ«»", "fee": "å…è²»", "tags": ["å··å¼„", "æ—©é³¥", "æ”å½±"], "desc": "å°åŒ—ç¬¬ä¸€æ³¢æ«»èŠ±ï¼Œåœç‰†æ¢å‡ºçš„ç²‰ç´…èŠ±æµ·ã€‚"},
    {"name": "ä¸­æ­£ç´€å¿µå ‚", "region": "åŒ—éƒ¨", "loc": "å°åŒ—ä¸­æ­£", "month": [2, 3], "flower": "å¤§æ¼æ«»/å…«é‡æ«»", "fee": "å…è²»", "tags": ["æ·é‹", "æ˜“é”", "æ•£æ­¥"], "desc": "å¸‚ä¸­å¿ƒæœ€æ–¹ä¾¿çš„è³æ«»é»ï¼Œè—ç™½å»ºç¯‰é…ç²‰èŠ±ã€‚"},
    {"name": "ä¸‰å³½å¤§ç†Šæ«»èŠ±æ—", "region": "åŒ—éƒ¨", "loc": "æ–°åŒ—ä¸‰å³½", "month": [1, 2, 3], "flower": "ä¸‰è‰²æ«»", "fee": "$250", "tags": ["å¤§æ™¯", "å¤œæ«»", "ç§äºº"], "desc": "4000æ£µæ«»èŠ±æŸ“ç´…å±±é ­ï¼Œå¤œé–“é»ç‡ˆè¶…æµªæ¼«ã€‚"},
    {"name": "çƒä¾†è§€å…‰å°è»Š", "region": "åŒ—éƒ¨", "loc": "æ–°åŒ—çƒä¾†", "month": [2], "flower": "å±±æ«»/å…«é‡æ«»", "fee": "å…è²»", "tags": ["æº«æ³‰", "ç«è»Š", "è€è¡—"], "desc": "æ­å°è»Šçœ‹ç€‘å¸ƒè³æ«»èŠ±ï¼Œé †ä¾¿æ³¡æ¹¯åƒé¦™è…¸ã€‚"},
    {"name": "ä¸‰èŠä¸‰ç”Ÿæ­¥é“", "region": "åŒ—éƒ¨", "loc": "æ–°åŒ—ä¸‰èŠ", "month": [3], "flower": "å‰é‡æ«»", "fee": "å…è²»", "tags": ["æ­¥é“", "æµæ°´", "å¹³åœ°"], "desc": "å°æ©‹æµæ°´äººå®¶ï¼Œæ²¿è‘—æºªå²¸ç¶¿å»¶2å…¬é‡Œçš„æ«»èŠ±ã€‚"},

    # === â›°ï¸ æ¡ƒç«¹è‹— (å±±åŸç§˜å¢ƒ) ===
    {"name": "å¸é¦¬åº«æ–¯", "region": "åŒ—éƒ¨", "loc": "æ–°ç«¹å°–çŸ³", "month": [2], "flower": "æ˜­å’Œæ«»", "fee": "é ç´„", "tags": ["æ·±å±±", "éƒ¨è½", "å¤§æ™¯"], "desc": "ä¸Šå¸çš„éƒ¨è½ï¼Œä¸€ç”Ÿå¿…å»çš„ç²‰ç´…ä»™å¢ƒã€‚"},
    {"name": "æ–°ç«¹å…¬åœ’", "region": "åŒ—éƒ¨", "loc": "æ–°ç«¹å¸‚å€", "month": [2], "flower": "æ²³æ´¥æ«»", "fee": "å…è²»", "tags": ["ç»ç’ƒ", "é‡é¤", "å¸‚å€"], "desc": "æ–°ç«¹äººçš„å¾ŒèŠ±åœ’ï¼Œéº—æ± æ—çš„æ—¥å¼é¢¨æƒ…ã€‚"},
    {"name": "å±±ä¸Šäººå®¶", "region": "åŒ—éƒ¨", "loc": "æ–°ç«¹äº”å³°", "month": [2, 3], "flower": "å‰é‡æ«»", "fee": "$200", "tags": ["èŒ¶åœ’", "é›²æµ·", "æ”å½±"], "desc": "ç¿ ç¶ èŒ¶åœ’èˆ‡ç²‰å«©æ«»èŠ±çš„çµ•ç¾å°æ¯”ã€‚"},
    {"name": "è§€éœ§å±±èŠ", "region": "åŒ—éƒ¨", "loc": "è‹—æ —æ³°å®‰", "month": [3], "flower": "éœ§ç¤¾æ«»", "fee": "å…è²»", "tags": ["éœ§ç¤¾æ«»ç‹", "æ·±å±±", "é›ªç™½"], "desc": "å…¨å°æœ€å¤§éœ§ç¤¾æ«»ç‹ï¼Œæ»¿æ¨¹é›ªç™½å¦‚é›²ã€‚"},
    {"name": "å”é›²å®®", "region": "åŒ—éƒ¨", "loc": "è‹—æ —ç…æ½­", "month": [1, 2], "flower": "å±±æ«»èŠ±", "fee": "å…è²»", "tags": ["å»Ÿå®‡", "é›²æµ·", "æ”å½±"], "desc": "é›²éœ§ç¹šç¹çš„å±±ä¸­å»Ÿå®‡ï¼Œæ•¸åƒæ£µæ«»èŠ±åŒ…åœã€‚"},
    {"name": "éŠ…é‘¼èŒ¶å» ", "region": "åŒ—éƒ¨", "loc": "è‹—æ —éŠ…é‘¼", "month": [2], "flower": "å±±æ«»/å‰é‡æ«»", "fee": "$100", "tags": ["ç«è»Š", "èŒ¶åœ’", "è¿½ç„¦"], "desc": "å¯ä»¥æ‹åˆ°ç«è»Šç¶“éæ«»èŠ±èˆ‡èŒ¶åœ’çš„çµ•ä½³è¦–è§’ã€‚"},

    # === ğŸŒ¸ ä¸­å½°æŠ• (ç¶“å…¸å¤§æ™¯) ===
    {"name": "æ­¦é™µè¾²å ´", "region": "ä¸­éƒ¨", "loc": "å°ä¸­å’Œå¹³", "month": [2], "flower": "ç´…ç²‰ä½³äºº", "fee": "$160", "tags": ["å¿…å»", "å¤§æ™¯", "é‡é¤"], "desc": "å°ç£è³æ«»çš„ä»£åè©ï¼Œæ²’æœ‰ä¹‹ä¸€ã€‚"},
    {"name": "ç¦å£½å±±è¾²å ´", "region": "ä¸­éƒ¨", "loc": "å°ä¸­å’Œå¹³", "month": [2, 3], "flower": "åƒå³¶æ«»", "fee": "$100", "tags": ["é«˜å±±", "å½å‡ºåœ‹", "é€šè¨Šå¡”"], "desc": "åƒæ«»åœ’çš„ç²‰ç´…é¢¨æš´ï¼ŒèƒŒæ™¯æ˜¯é›ªå±±å±±è„ˆã€‚"},
    {"name": "åé‡Œæ³°å®‰æ´¾å‡ºæ‰€", "region": "ä¸­éƒ¨", "loc": "å°ä¸­åé‡Œ", "month": [2], "flower": "å…«é‡æ«»", "fee": "å…è²»", "tags": ["å¹³åœ°", "å¤œæ«»", "æ˜“é”"], "desc": "å…¨å°æœ€ç¾æ´¾å‡ºæ‰€ï¼Œåœè»Šå ´å°±æ˜¯æ»¿æ»¿æ«»èŠ±ã€‚"},
    {"name": "æ–°ç¤¾æ«»æœ¨èŠ±é“", "region": "ä¸­éƒ¨", "loc": "å°ä¸­æ–°ç¤¾", "month": [2], "flower": "å…«é‡æ«»", "fee": "å…è²»", "tags": ["è¡—é“", "å…œé¢¨", "é¦™è‡"], "desc": "æ–°ç¤¾å€å…¬æ‰€æ—çš„ç²‰ç´…è¡—é“ï¼Œé †ä¾¿åƒé¦™è‡ç«é‹ã€‚"},
    {"name": "ä¹æ—æ–‡åŒ–æ‘", "region": "ä¸­éƒ¨", "loc": "å—æŠ•é­šæ± ", "month": [2], "flower": "å…«é‡æ«»/å‰é‡æ«»", "fee": "$900", "tags": ["æ¨‚åœ’", "å¤œæ«»", "çºœè»Š"], "desc": "å…¨å°å”¯ä¸€æ—¥æœ¬èªè­‰è³æ«»åæ‰€ï¼Œå¤œæ«»ç¥­å¿…çœ‹ã€‚"},
    {"name": "è‰åªé ­ç‰å±±è§€å…‰èŒ¶åœ’", "region": "ä¸­éƒ¨", "loc": "å—æŠ•ä¿¡ç¾©", "month": [1, 2], "flower": "å±±æ«»/æèŠ±", "fee": "$50", "tags": ["èŒ¶åœ’", "é›™è‰²", "å¥è¡Œ"], "desc": "æ«»èŠ±ã€æèŠ±ã€æ¡ƒèŠ±é½Šé–‹ï¼Œäº”å½©ç¹½ç´›çš„å±±å¡ã€‚"},
    {"name": "å¥§è¬å¤§", "region": "ä¸­éƒ¨", "loc": "å—æŠ•ä»æ„›", "month": [1, 2, 3], "flower": "éœ§ç¤¾æ«»/å±±æ«»", "fee": "$200", "tags": ["æ£®æ—", "åŠæ©‹", "è³é³¥"], "desc": "ä¸åªè³æ¥“ï¼Œæ˜¥å¤©çš„å¥§è¬å¤§æ˜¯æ«»èŠ±èˆ‡é³¥é¡å¤©å ‚ã€‚"},
    {"name": "æš¨å—å¤§å­¸", "region": "ä¸­éƒ¨", "loc": "å—æŠ•åŸ”é‡Œ", "month": [2], "flower": "å±±æ«»/å…«é‡æ«»", "fee": "åœè»Šè²»", "tags": ["æ ¡åœ’", "é‡é¤", "å¤§è‰çš®"], "desc": "å…¨å°æœ€ç¾æ ¡åœ’æ«»èŠ±å­£ï¼Œåœ¨æ«»èŠ±æ¨¹ä¸‹é‡é¤è¶…Chillã€‚"},
    {"name": "è‰å¶ºçŸ³å£", "region": "ä¸­éƒ¨", "loc": "é›²æ—å¤å‘", "month": [2, 3], "flower": "ç™½èŠ±å±±æ«»", "fee": "å…è²»", "tags": ["ç§˜å¢ƒ", "ç™½è‰²", "æ­¥é“"], "desc": "å…¨å°æ¥µç½•è¦‹çš„ã€Œç¾äººè°·ã€ï¼Œæ»¿å±±ç™½èŠ±å±±æ«»ã€‚"},
    {"name": "å“¡æ—è—¤å±±æ­¥é“", "region": "ä¸­éƒ¨", "loc": "å½°åŒ–å“¡æ—", "month": [3], "flower": "å‰é‡æ«»", "fee": "å…è²»", "tags": ["å¥è¡Œ", "å¸‚é›†", "å¹³åœ°"], "desc": "é‚Šçˆ¬å±±é‚Šè³èŠ±ï¼Œé€±æœ«é‹å‹•çš„å¥½å»è™•ã€‚"},

    # === ğŸš‚ é›²å˜‰å—é«˜å± (å—éƒ¨ç†±æƒ…) ===
    {"name": "é˜¿é‡Œå±±æ£®æ—éŠæ¨‚å€", "region": "å—éƒ¨", "loc": "å˜‰ç¾©é˜¿é‡Œå±±", "month": [3, 4], "flower": "å‰é‡æ«»", "fee": "$200", "tags": ["ç«è»Š", "æ—¥å‡º", "å¿…å»"], "desc": "å°ç«è»Šç©¿æ¢­æ«»èŠ±æ—ï¼Œä¸–ç•Œç´šçš„æ™¯è§€ã€‚"},
    {"name": "éš™é ‚/çŸ³æ£¹", "region": "å—éƒ¨", "loc": "å˜‰ç¾©ç•ªè·¯", "month": [2, 3], "flower": "æ˜­å’Œæ«»", "fee": "å…è²»", "tags": ["ç‰ç’ƒå…‰", "å¤œæ™¯", "æ”å½±"], "desc": "é•·æ›ç‰ç’ƒå…‰èˆ‡æ«»èŠ±åŒæ¡†çš„æ”å½±è–åœ°ã€‚"},
    {"name": "å¯’æºªå‘¢æ£®æ—äººæ–‡å¡åœ°", "region": "å—éƒ¨", "loc": "å˜‰ç¾©æ¢…å±±", "month": [1, 2], "flower": "ç¦çˆ¾æ‘©æ²™æ«»", "fee": "$220", "tags": ["å¤ªæ¥µ", "ç™½è‰²", "ç§˜å¢ƒ"], "desc": "å‘¨å­ç‘œä¹Ÿå»éï¼ç™½è‰²æ«»èŠ±éš§é“é€šå¾€è–å¡”å±±ã€‚"},
    {"name": "æ¢…å±±36å½", "region": "å—éƒ¨", "loc": "å˜‰ç¾©æ¢…å±±", "month": [12, 1], "flower": "å±±æ«»", "fee": "å…è²»", "tags": ["å…¬è·¯", "å…œé¢¨", "æ—©é–‹"], "desc": "é–‹è»ŠæŒ‘æˆ°36å½ï¼Œæ²¿é€”é»ç¶´ç´…è‰²å±±æ«»ã€‚"},
    {"name": "ç™½æ²³é—œå­å¶º", "region": "å—éƒ¨", "loc": "å°å—ç™½æ²³", "month": [1, 2], "flower": "å±±æ«»", "fee": "å…è²»", "tags": ["æº«æ³‰", "å¥è¡Œ", "ç¾é£Ÿ"], "desc": "ç´…è‘‰å…¬åœ’è³å®ŒèŠ±ï¼Œä¸‹å±±åƒç”•ä»”é›æ³¡æ³¥æ¼¿æº«æ³‰ã€‚"},
    {"name": "çƒå±±é ­æ°´åº«", "region": "å—éƒ¨", "loc": "å°å—å®˜ç”°", "month": [3], "flower": "å—æ´‹æ«»", "fee": "$80", "tags": ["æ°´åº«", "é¦™æ¦­", "ç•°åœ‹"], "desc": "è‘—åçš„é¦™æ¦­å¤§é“ï¼Œç²‰ç´…èŠ±ç“£é£„è½å¦‚ä¸‹é›ªã€‚"},
    {"name": "å¯¶å±±äºŒé›†åœ˜", "region": "å—éƒ¨", "loc": "é«˜é›„æ¡ƒæº", "month": [1, 2], "flower": "æ²³æ´¥æ«»", "fee": "å…è²»", "tags": ["æ—©é–‹", "å¥è¡Œ", "å—éƒ¨"], "desc": "å—éƒ¨äººä¸ç”¨è·‘ä¸­åŒ—éƒ¨ï¼Œé€™è£¡å°±æœ‰è¶…ç¾ç²‰ç´…èŠ±æµ·ã€‚"},
    {"name": "è—¤ææ£®æ—éŠæ¨‚å€", "region": "å—éƒ¨", "loc": "é«˜é›„æ¡ƒæº", "month": [1, 2], "flower": "å±±æ«»", "fee": "$120", "tags": ["æ£®æ—", "èŠ¬å¤šç²¾", "å¥è¡Œ"], "desc": "å—éƒ¨å°æºªé ­ï¼Œåœ¨æ£®æ¿¤ä¸­å°‹æ‰¾æ«»èŠ±è¹¤å½±ã€‚"},
    {"name": "éœ§å°æ«»èŠ±ç‹", "region": "å—éƒ¨", "loc": "å±æ±éœ§å°", "month": [2], "flower": "å±±æ«»", "fee": "æ¸…æ½”è²»", "tags": ["éƒ¨è½", "éœ¸æ°£", "æ„›ç‰"], "desc": "ä¸€æ£µæ¨¹å°±é–‹æ»¿æ•´å€‹åº­é™¢ï¼Œé­¯å‡±æ—éƒ¨è½å‚³å¥‡ã€‚"},

    # === ğŸŒŠ å®œèŠ±æ± (å¾Œå±±æ·¨åœŸ) ===
    {"name": "å®œè˜­å¤§åŒæ«»èŠ±æ—", "region": "æ±éƒ¨", "loc": "å®œè˜­å¤§åŒ", "month": [2], "flower": "å…«é‡æ«»", "fee": "å…è²»", "tags": ["å…¬è·¯", "å…œé¢¨", "éœ²ç‡Ÿ"], "desc": "å°7ç”²ç·šæ²¿è·¯éƒ½æ˜¯æ«»èŠ±ï¼Œé€šå¾€æ­¦é™µçš„å¿…ç¶“ä¹‹è·¯ã€‚"},
    {"name": "æ˜æ± æ£®æ—éŠæ¨‚å€", "region": "æ±éƒ¨", "loc": "å®œè˜­å¤§åŒ", "month": [2, 3], "flower": "å¤§å³¶æ«»", "fee": "$120", "tags": ["æ¹–æ™¯", "éœè¬", "é¿æš‘"], "desc": "åŒ—æ©«æ˜ç ï¼Œæ¹–ç•”çš„æ«»èŠ±å¸¶æœ‰ä¸€è‚¡ä»™æ°£ã€‚"},
    {"name": "æ£²è˜­æ£®æ—éŠæ¨‚å€", "region": "æ±éƒ¨", "loc": "å®œè˜­å¤§åŒ", "month": [2], "flower": "ç´…ç²‰ä½³äºº", "fee": "$100", "tags": ["ç¥æœ¨", "ä½å®¿", "æ­·å²"], "desc": "è”£å…¬è¡Œé¤¨å‰çš„æ«»èŠ±ç‹ï¼Œæ»¿é–‹æ™‚éå¸¸å£¯è§€ã€‚"},
    {"name": "ç¾…èŠæ«»èŠ±æ­¥é“", "region": "æ±éƒ¨", "loc": "å®œè˜­ç¾…æ±", "month": [2, 3], "flower": "å¢¨æŸ“æ«»", "fee": "å…è²»", "tags": ["å¹³åœ°", "æ°´å²¸", "å¤œæ«»"], "desc": "å¹³åœ°æœ€ç¾æ«»èŠ±æ²³å²¸ï¼Œå€’å½±éå¸¸è¿·äººã€‚"},
    {"name": "ç‰å±±ç¥å­¸é™¢", "region": "æ±éƒ¨", "loc": "èŠ±è“®å£½è±", "month": [2, 3], "flower": "éœ§ç¤¾æ«»", "fee": "å…è²»", "tags": ["æ¹–æ™¯", "å­¸è¡“", "å¯§éœ"], "desc": "ä¿¯ç°é¯‰é­šæ½­ï¼Œç™½è‰²éœ§ç¤¾æ«»é…ä¸Šæ¹–å…‰å±±è‰²ã€‚"},
    {"name": "å¤ªéº»é‡Œé‡‘é‡å±±", "region": "æ±éƒ¨", "loc": "å°æ±å¤ªéº»é‡Œ", "month": [1, 2], "flower": "å±±æ«»/å…«é‡æ«»", "fee": "å…è²»", "tags": ["æ—¥å‡º", "ç™»å±±", "é›²éœ§"], "desc": "ä¸åªé‡‘é‡èŠ±ï¼Œæ˜¥å¤©çš„é’å±±è¾²å ´æ«»èŠ±æ­¥é“è¶…ç¾ã€‚"}
]

# ==========================================
# 4. é‚è¼¯æ ¸å¿ƒï¼šæ™ºæ…§æœå°‹èˆ‡æ¨è–¦
# ==========================================
def search_spots(keyword, region_filter, tag_filter):
    results = []
    for spot in all_spots_db:
        # 1. åœ°å€ç¯©é¸
        if region_filter != "å…¨å°" and spot['region'] != region_filter:
            continue
        
        # 2. é—œéµå­—æœå°‹ (åç¨±ã€åœ°é»ã€æè¿°)
        if keyword:
            if (keyword not in spot['name'] and 
                keyword not in spot['loc'] and 
                keyword not in spot['desc'] and
                keyword not in spot['flower']):
                continue
        
        # 3. æ¨™ç±¤ç¯©é¸
        if tag_filter != "ä¸é™":
            if tag_filter not in spot['tags']:
                continue
                
        results.append(spot)
    return results

# ==========================================
# 5. UI å‘ˆç¾
# ==========================================
st.markdown("""
    <div class="header-box">
        <div class="header-title">ğŸŒ¸ 2026 å…¨åœ‹è³æ«»ç™¾ç§‘</div>
        <div style="color:white; opacity:0.9; margin-top:10px;">
            å¾©èˆˆå€é•· <b>è˜‡ä½ç’½</b> åš´é¸ï½œæ”¶éŒ„å…¨å° <b>{count}</b> å€‹è³æ«»ç§˜å¢ƒ
        </div>
    </div>
""".format(count=len(all_spots_db)), unsafe_allow_html=True)

# --- æœå°‹æ§åˆ¶å° ---
with st.container():
    st.markdown('<div class="search-box">', unsafe_allow_html=True)
    c1, c2, c3 = st.columns([1, 1, 2])
    with c1:
        region = st.selectbox("ğŸ“ é¸æ“‡å€åŸŸ", ["å…¨å°", "åŒ—éƒ¨", "ä¸­éƒ¨", "å—éƒ¨", "æ±éƒ¨"])
    with c2:
        tag = st.selectbox("ğŸ·ï¸ ç‰¹è‰²ç¯©é¸", ["ä¸é™", "ç§˜å¢ƒ", "è¦ªå­", "å¤œæ«»", "å¹³åœ°", "å¤§æ™¯", "å…è²»", "æ·é‹"])
    with c3:
        keyword = st.text_input("ğŸ” é—œéµå­—æœå°‹", placeholder="è¼¸å…¥ï¼šæ­¦é™µã€æ¡ƒåœ’ã€æ‹‰æ‹‰å±±...")
    st.markdown('</div>', unsafe_allow_html=True)

# --- æœå°‹çµæœ ---
results = search_spots(keyword, region, tag)

if not results:
    st.warning("ğŸ˜… å“å‘€ï¼è˜‡å€é•·åŠªåŠ›æ‰¾äº†ï¼Œä½†æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ™¯é»ã€‚è©¦è‘—æ”¾å¯¬æœå°‹æ¢ä»¶çœ‹çœ‹ï¼Ÿ")
else:
    st.success(f"ğŸ‰ æ‰¾åˆ° **{len(results)}** å€‹çµ•ç¾è³æ«»é»ï¼è¶•å¿«ç­†è¨˜ä¸‹ä¾†ï¼")
    
    # ä½¿ç”¨ Grid æ’ç‰ˆ (3æ¬„)
    cols = st.columns(3)
    for i, spot in enumerate(results):
        with cols[i % 3]:
            # å‹•æ…‹ç”Ÿæˆæ¨™ç±¤ HTML
            tags_html = "".join([f'<span class="badge b-tag">{t}</span>' for t in spot['tags']])
            if "ç§˜å¢ƒ" in spot['tags']: tags_html = f'<span class="badge b-secret">éš±è—ç‰ˆ</span>' + tags_html
            
            st.markdown(f"""
            <div class="spot-card">
                <h3 style="color:#C71585; margin-bottom:5px;">{spot['name']}</h3>
                <div style="font-size:14px; color:#666; margin-bottom:10px;">
                    ğŸ“ {spot['loc']} | ğŸŒ¸ {spot['flower']}
                </div>
                <div style="margin-bottom:10px;">
                    <span class="badge b-region">{spot['region']}</span>
                    {tags_html}
                </div>
                <p style="font-size:15px; line-height:1.5;">{spot['desc']}</p>
                <hr style="border-top: 1px dashed #FFB6C1;">
                <div style="display:flex; justify-content:space-between; font-size:13px; color:#888;">
                    <span>ğŸ“… èŠ±æœŸ: {spot['month'][0]}-{spot['month'][-1]}æœˆ</span>
                    <span>ğŸ’° {spot['fee']}</span>
                </div>
            </div>
            """, unsafe_allow_html=True)

# --- åº•éƒ¨å½©è›‹ ---
st.markdown("---")
st.markdown("""
<div style="text-align:center; padding:20px; color:#666;">
    ğŸ’¡ <b>è˜‡å€é•·å°å®åš€</b>ï¼šèŠ±æ³å—æ°£å€™å½±éŸ¿å¾ˆå¤§ï¼Œå‡ºç™¼å‰å»ºè­°å…ˆæŸ¥çœ‹è©²æ™¯é»çš„å®˜æ–¹ç²‰å°ˆæœ€æ–°èŠ±æ³å–”ï¼<br>
    å°¤å…¶æ˜¯ <b style="color:#C71585;">æ¡ƒåœ’å¾©èˆˆå€</b> çš„æ«»èŠ±ï¼Œæ¯å¹´éƒ½ç¾åˆ°åƒç½®èº«åœ‹å¤–ï¼Œä¸€å®šè¦ä¾†ç©ï¼
</div>
""", unsafe_allow_html=True)
